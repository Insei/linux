/*
 * arch/arm/boot/dts/tegra124-mocha.dts
 *
 * Copyright (c) 2018, Alexandrov Dmirty.  All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
/dts-v1/;

#include "tegra124.dtsi"
#include "tegra124-mocha-emc.dtsi"
#include "tegra124-mocha-keys.dtsi"
#include "tegra124-mocha-pinmux.dtsi"
#include "tegra124-mocha-sdhci.dtsi"
#include "tegra124-mocha-pmic.dtsi"
#include "tegra124-mocha-fixed.dtsi"
#include "tegra124-mocha-i2c.dtsi"
#include "tegra124-mocha-display.dtsi"
#include "tegra124-mocha-touchscreens.dtsi"
#include "tegra124-mocha-usb.dtsi"

/ {
	model = "NVIDIA Tegra124 MOCHA";
	compatible = "nvidia,mocha", "nvidia,tegra124";
	nvidia,boardids = "1780:1100:3:A:7","1845:1000:0:A:7";

	aliases {
		rtc0 = "/i2c@0,7000d000/pmic@58";
		rtc1 = "/rtc@0,7000e000";
	};

	memory {
		reg = <0x0 0x80000000 0x0 0x80000000>;
	};

	chosen {
		bootargs = "cros_legacy init=/init rw fbcon loglevel=0 debug earlyprintk drm.atomic=1 no_console_suspend";
	};

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;
	
		pstore: pstore {
			reg = <0 0xfd400000 0 0x200000>;
			compatible = "ramoops";
			record-size = <0x10000>;
			console-size = <0x80000>;
			pmsg-size = <0x40000>;
			ftrace-size = <0x80000>;
			rtrace-size = <0x80000>;
			no-map;
			status = "okay";
		};
	};

	psci {
		compatible = "arm,psci-0.2";
		method = "smc";
	};

	pwm@7000a000 {
		status = "okay";
	};

	gpu@0,57000000 {
		vdd-supply = <&vdd_gpu>;
		status = "okay";
	};

	/* CPU DFLL clock */
	clock@70110000 {
		status = "okay";
		vdd-cpu-supply = <&vdd_cpu>;
		nvidia,i2c-fs-rate = <400000>;
	};

	clocks {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		clk32k_in: clock@0 {
			compatible = "fixed-clock";
			reg = <0>;
			#clock-cells = <0>;
			clock-frequency = <32768>;
		};
	};

	mipi: mipi@700e3000 {
		status = "okay";
	};

	cpus {
		cpu@0 {
			vdd-cpu-supply = <&vdd_cpu>;
			enable-method = "psci";
		};

		cpu@1 {
			enable-method = "psci";
		};

		cpu@2 {
			enable-method = "psci";
		};

		cpu@3 {
			enable-method = "psci";
		};
	};
	
	thermal-zones {
		cpu {
			trips {
				cpu-shutdown-trip {
					temperature = <101000>;
					hysteresis = <0>;
					type = "critical";
				};
			};
		};

		mem {
			trips {
				mem-shutdown-trip {
					temperature = <101000>;
					hysteresis = <0>;
					type = "critical";
				};
			};
		};

		gpu {
			trips {
				gpu-shutdown-trip {
					temperature = <101000>;
					hysteresis = <0>;
					type = "critical";
				};
			};
		};
	};

	i2c@7000c000 {
		rt5671: rt5671@1c {
			compatible = "realtek,rt5671";
			reg = <0x1c>;

	                realtek,jd_mode = <2>;
	                realtek,dev_gpio = <&gpio 178 0>;
	                realtek,in2_diff = <1>;
	                realtek,in3_diff = <0>;
	                realtek,in4_diff = <1>;
	                realtek,bclk_32fs = <0 1 1 1>;
		};

		tfa9890@34 {
			compatible = "nxp,tfa9890";
			reg = <0x34>;
		};

		tfa9890@37 {
			compatible = "nxp,tfa9890";
			reg = <0x37>;
		};

	};

	sound {
		compatible = "nvidia,tegra-audio-rt5671";
		nvidia,model = "Xiaomi MiPad";

		nvidia,audio-routing =
			"Headphones", "HPOR",
			"Headphones", "HPOL",
			"Mic Jack", "MICBIAS1",
			"IN2P", "Mic Jack";

		nvidia,i2s-controller = <&tegra_i2s1>;
		nvidia,audio-codec = <&rt5671>;

		nvidia,hp-det-gpios = <&gpio TEGRA_GPIO(R, 7) GPIO_ACTIVE_LOW>;

		clocks = <&tegra_car TEGRA124_CLK_PLL_A>,
			 <&tegra_car TEGRA124_CLK_PLL_A_OUT0>,
			 <&tegra_car TEGRA124_CLK_EXTERN1>,
			 <&tegra_car TEGRA124_CLK_EMC>;
		clock-names = "pll_a", "pll_a_out0", "mclk", "emc";
	};
};
